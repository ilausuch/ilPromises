ilPromise=function(i){this.data=void 0,this.isLoading=!0,this.isError=!1,this.hasFinished=!1,this.successEmitter=new ilEventsEmitter,this.errorEmitter=new ilEventsEmitter,void 0==i&&(i={}),void 0==i.context?this.context=ilPromisesContext:this.context=i.context,void 0!=i.owner&&(this.owner=i.owner),this.ready=function(i){this.data=i,this.isLoading=!1,this.hasFinished=!0;var t=this;this.context.delayFnc(function(){t.successEmitter.length()>0&&t.successEmitter.send(t.data)})},this.error=function(i){var t=this;this.hasFinished=!0,this.isLoading=!1,this.isError=!1,this.error=i,this.context.delayFnc(function(){if(!(t.errorEmitter.length()>0))throw new ilModelException("ilPromise","Error loading data",{theOwner:t.owner,error:i});t.errorEmitter.send(t.error)})},this.then=function(i,t){if(this.hasFinished){var s=this;this.context.delayFnc(function(){s.isError?i instanceof ilPromise?t.error(s.error):t(error):i instanceof ilPromise?i.ready(s.data):i(s.data)})}else i instanceof ilPromise?(this.successEmitter.register(function(t){i.ready(t)}),this.errorEmitter.register(function(t){i.error(t)})):(this.successEmitter.register(i),this.errorEmitter.register(t));return this},void 0!=i.data&&this.ready(i.data)},ilPromiseSync=function(i){this.isLoading=!0,this.isError=!1,this.hasFinished=!1,this.successEmitter=new ilEventsEmitter,this.errorEmitter=new ilEventsEmitter,void 0==i&&(i={}),void 0==i.context?this.context=ilPromisesContext:this.context=i.context,void 0!=i.owner&&(this.owner=i.owner),this.syncList=[],this.addTask=function(i,t){var s=this.add(t);i(s)},this.add=function(i){this.isLoading=!0,this.hasFinished=!1,void 0==i&&(i={});var t={id:this.syncList.length,options:i,sync:this,isLoading:!0,isError:!1,hasFinished:!1,data:void 0,error:void 0,ready:function(i){if(this.hasFinished)throw new ilModelException("ilPromiseSync.object","This sync is already finished",{theSyncObject:this});this.hasFinished=!0,this.isLoading=!1,this.data=i,this.sync.ready(this)},error:function(i){if(this.hasFinished)throw new ilModelException("ilPromiseSync.object","This sync is already finished",{theSyncObject:this});this.hasFinished=!0,this.isLoading=!1,this.isError=!0,this.error=i,this.sync.ready(this)}};return this.syncList.push(t),t},this.ready=function(i){var t=!0;if(this.syncList.some(function(i){if(!i.hasFinished)return t=!1,!1}),t){this.isLoading=!1,this.hasFinished=!0;var s=!1;if(this.syncList.some(function(i){if(i.isError)return s=!0,!0}),s){var e=this;this.context.delayFnc(function(){if(!(e.errorEmitter.length()>0))throw new ilModelException("ilPromise","Error loading data",{theOwner:e.owner,error:err});e.errorEmitter.send(e.syncList)})}else{var e=this;this.context.delayFnc(function(){e.successEmitter.length()>0&&e.successEmitter.send(e.syncList)})}}},this.then=function(i,t){if(this.hasFinished){var s=this;this.context.delayFnc(function(){s.isError?i instanceof ilPromise?t.error(s.error):t(error):i instanceof ilPromise?i.ready(s.data):i(s.data)})}else i instanceof ilPromise?(this.successEmitter.register(function(t){i.ready(t)}),this.errorEmitter.register(function(t){i.error(t)})):(this.successEmitter.register(i),this.errorEmitter.register(t));return this},this.progress=function(){var i=0;return this.syncList.forEach(function(t){t.hasFinished&&i++}),{completed:i,total:this.syncList.length}}},ilPromisesContext={delayFnc:function(i){setTimeout(i)},setupDefaultAngularContext:function(i){ilModelConfiguration.defaultContext.delayFnc=function(t){i(t)}}};